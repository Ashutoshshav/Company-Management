


<style>
	/* Global Styles */


	/* Container */
	.maincontainer {
		width: 70%;
		margin: 110px auto 0 auto;
	}

	#topcontainer {
		display: flex;
		height: 6vh;
		margin: 115px 160px 20px 160px;
		justify-content: space-between;
	}
	/* Card */
	.card {
		background: #ffffff;
		box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
		border-radius: 10px;
		overflow: hidden;
	}

	/* Card Header */
	.card-header {
		background: #31708F;
		color: white;
		text-align: center;
		padding: 15px;
		font-size: 20px;
		display: flex;
	}

	/* Card Body */
	.card-body {
		padding: 10px 20px;
	}

	/* Form Styles */
	.form-row {
		display: flex;
		gap: 20px;
		margin-bottom: 5px;
	}

	.form-group {
		flex: 1;
	}

	.full-width {
		flex: 100%;
	}

	label {
		display: block;
		margin-bottom: 1px;
	}

	input,
	textarea {
		width: 100%;
		padding: 3px;
		border: 1px solid #ccc;
		border-radius: 5px;
		color: #707070;
		font-size: 14px;
		margin: 0 5px 0 0px;
	}

	#Challan_Type {
		width: 100%;
		padding: 4px 7px;
		border: 1px solid #ccc;
		border-radius: 5px;
		font-size: 13px;
		color: #707070;
		margin: 0px 5px 0 5px;
	}
	/* Submit Button */
	.form-actions {
		text-align: center;
		margin-top: 20px;
	}

	.button {
		background: rgb(59,130,246);
		background: linear-gradient(90deg, rgba(59,130,246,1) 0%, rgba(29,78,216,1) 100%);
		color: white;
		padding: 5px 20px;
		font-size: 16px;
		border: none;
		border-radius: 5px;
		cursor: pointer;
		width: 100%;
	}

	button:hover {
		background: #218838;
	}

	.link {
		font-size: 14px;
		background: rgb(59,130,246);
		background: linear-gradient(90deg, rgba(59,130,246,1) 0%, rgba(29,78,216,1) 100%);
		border-radius: 4px;
		align-content: center;
		box-shadow: 2px 2px 4px #5a5a5a;
		cursor: pointer;
		color: white;
		font-weight: 600;
		width: 50%;
		text-align: center;
	}

		.link:hover {
			background: rgb(0 43 163);
		}

	hr {
		width: 80%;
		margin: 0 auto;
	}

	#tablemaster {
		width: 80%;
	}
	.table_input {
		background: none;
		border: none;
	}

		/* When the input is focused, keep it the same (no border, no background) */
		.table_input:focus {
			background: none;
			border: none;
			box-shadow: none;
			outline: none;
		}

	.submit-btn {
		background: linear-gradient(80deg, rgb(102 239 142) 0%, rgb(33 181 8) 100%);
		padding: 3px 50px;
		border-radius: 4px;
		box-shadow: 2px 2px 7px #a2a2a2;
		margin: 15px 0px;
		cursor: pointer;
		color: #505050;
		font-weight: 600;
	}

		.submit-btn:hover {
			background: #00b600;
		}
</style>
<style>
	.input-container {
		position: relative;
		width: 250px;
	}

	#PartyName {
		width: 100%;
		padding: 6.8px;
		border: 1px solid #ccc;
		border-radius: 4px;
		height: 100%;
	}

	#dropdown {
		width: 100%;
		display: none;
		max-height: 200px; /* Set a max height to limit the dropdown's size */
		overflow-y: hidden; /* Remove vertical scrollbar */
		border: 1px solid #ccc;
		border-radius: 4px;
		background-color: white;
		z-index: 10000;
		position: relative;
	}
	
#sideinput{
		width: 100%;
		height: 100%;
}
</style>
<style>
	/* Simple modal styling */
	#challanModal {
		display: none;
		position: fixed;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		background: white;
		padding: 20px;
		box-shadow: 0px 0px 10px gray;
		border-radius: 5px;
		z-index: 1000;
		width: 325px;
		z-index: 1000;
	}

	#popupOverlay {
		display: none;
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: rgba(0, 0, 0, 0.5);
		z-index: 999;
	}

	#challanModal h3 {
		text-align: center;
	}

	#challanModal p {
		text-align: center;
		margin: 30px;
	}

	#challanModal .circle {
		width: 40px;
		height: 40px;
		border-radius: 50%;
		border: 2px solid black;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 20px;
		font-weight: bold;
		color: black;
		background: #3ce85e;
		margin: 30px auto;
	}

	#challanModal #pdfButton {
		background: linear-gradient(90deg, rgba(59, 130, 246, 1) 0%, rgba(29, 78, 216, 1) 100%);
		padding: 5px 10px;
		border-radius: 4px;
		box-shadow: 2px 2px 5px gray;
		color: white;
		font-weight: 600;
	}

	#challanModal #okButton {
		background: linear-gradient(90deg, rgb(59 246 129) 0%, rgb(29 216 57) 100%);
		padding: 5px 50px;
		
		border-radius: 4px;
		box-shadow: 2px 2px 5px gray;
		color: black;
		font-weight: 600;
	}

</style>
<link href="~/css/GenerateChallan-1.css" rel="stylesheet" />
<div id="topcontainer">
	<div id="sideinput">
		<input type="text" id="PartyName" placeholder="Party Name" autocomplete="off">
		<input type="text" id="PartyID" hidden placeholder="Party Name" autocomplete="off">
		<select id="dropdown" size="5" class="z-1000"></select>
	</div>
	<select id="Challan_Type" name="" required>

		<option value="">Select Status</option>
		<option value="1">IN</option>
		<option value="2">OUT</option>
	</select>
	<input type="date" id="currentdate" />
	<a class="link" href="/Challan/partyDetails">+ Add Party</a>
</div>


<hr />
<div class="mx-auto mt-3" id="tablemaster">
	<table class="w-full overflow-hidden rounded-lg border border-gray-200 bg-white shadow-md" id="dynamicTable">
		<thead class="z-10 bg-[#2582b0] text-xs uppercase text-white">
			<tr>
				<th class="px-1 py-2 text-center">Sr. No.</th>
				<th class="px-4 py-2">Description Of Goods</th>
				<th class="px-4 py-2 text-center">QTY</th>
				<th class="px-4 py-2 text-center">Remark</th>
			</tr>
		</thead>
		<tbody class="divide-y divide-gray-200 text-sm">
			<tr class="transition odd:bg-gray-50 hover:bg-gray-100">
				<td class="px-1 py-2 text-center">1</td>
				<td class="px-4 py-2 text-left"><input type="text" class="table_input w-full rounded-md border border-gray-300" oninput="addNewRow(this)" cla></td>
				<td class="px-4 py-2 text-center"><input type="text" class="table_input w-full rounded-md border border-gray-300 text-center" oninput="addNewRow(this)"></td>
				<td class="px-4 py-2 text-center"><input type="text" class="table_input w-full rounded-md border border-gray-300 text-center" oninput="addNewRow(this)"></td>
			</tr>
		</tbody>
	</table>
	<div style="display:flex; justify-content: end; ">
		<buttton class="submit-btn">Submit</buttton>
	</div>

</div>


<!-- Modal Structure -->
<div id="popupOverlay"></div>
<div id="challanModal">
	<div class="circle">&#10004;</div>
	<h3>Challan Data Saved Successfully!</h3>
	<p>Challan No : <span id="challanNo"></span></p>
	<h3 id="realchallanNo" style="display:none;"></h3>
	<div style="display: flex; justify-content: space-evenly;">
		<button id="pdfButton">Download PDF</button>
		<button id="okButton">OK</button>
	</div>
</div>
<div id="challanModal" style="display:none; position: fixed; top: 20%; left: 50%; transform: translateX(-50%); background: white; padding: 20px; box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1); border-radius: 8px; z-index: 1000;">

	<button id="pdfButton">Download PDF</button>
	<button id="okButton">OK</button>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
	$(document).ready(function() {
		$(".submit-btn").click(function() {
			// Collect the data from the table rows
			let tableData = [];
			$("#dynamicTable tbody tr").each(function() {
				// Get data from the input fields
				let row = {
					description: $(this).find("td:eq(1) input").val(),
					qty: $(this).find("td:eq(2) input").val(),
					remark: $(this).find("td:eq(3) input").val()
				};

				// Check if the row has valid data before adding to the array
				if(row.description && row.qty && row.remark) {
					tableData.push(row);
				}
			});

			// Get other form data (if needed)
			let partyID = $("#PartyID").val();
			console.log("fghj : "+ partyID);
			let Challan_Type = $("#Challan_Type").val();
			let currentDate = $("#currentdate").val();

			// Validate required data
			if (!partyID || !Challan_Type || !currentDate) {
				alert("Please fill all the required fields.");
				return;
			}

			// Prepare the data to be sent to the server
			let data = {
				PartyID: partyID,
				Challan_Type: Challan_Type,
				CurrentDate: currentDate,
				Items: tableData
			};

			// Send the data to the server via AJAX
			$.ajax({
				url: "/Challan/SaveData", // Replace with your server endpoint
				method: "POST",
				contentType: "application/json",
				data: JSON.stringify(data),
				success: function(response) {
					// Display Challan No. in the modal
					$("#challanNo").text(response.challanNo);  // response.challanNo should be returned from the server
					$("#realchallanNo").text("Challan No: " + response.realchallanNo);  // response.challanNo should be returned from the server
					$("#challanModal").show(); // Show the modal
					$("#popupOverlay").show(); // Show the modal
				},
				error: function(xhr, status, error) {
					alert("Error saving data: " + error);
				}
			});
		});

		// Handle PDF button click
		$("#pdfButton").click(function() {
			let realchallanNo = $("#realchallanNo").text().split(":")[1].trim(); // Get Challan No.
			window.location.href = `/Challan/DownloadPDF?challanNo=${realchallanNo}`; // Replace with your actual download endpoint
		});

		// Handle OK button click
		$("#okButton").click(function() {
			location.reload(); // Reload the page when OK is clicked
		});
	});
</script>





<script>
	function addNewRow(input) {
		let row = input.parentElement.parentElement;
		let table = document.getElementById("dynamicTable").getElementsByTagName('tbody')[0];

		// Check if it's the last row
		if (row === table.lastElementChild) {
			let rowCount = table.rows.length + 1;
			let newRow = document.createElement("tr");
			newRow.className = "transition odd:bg-gray-50 hover:bg-gray-100";

			newRow.innerHTML = `
				<td class="px-4 py-2 text-center">${rowCount}</td>
				<td class="px-4 py-2 text-left"><input type="text" class="table_input w-full rounded-md border border-gray-300" oninput="addNewRow(this)"></td>
				<td class="px-4 py-2 text-center"><input type="text" class="table_input w-full rounded-md border border-gray-300 text-center"  oninput="addNewRow(this)"></td>
				<td class="px-4 py-2 text-center"><input type="text" class="table_input w-full rounded-md border border-gray-300 text-center" oninput="addNewRow(this)"></td>
			`;

			table.appendChild(newRow);
		}
	}
</script>


<script>
	$(document).ready(function () {
		$("#PartyName").on("input", function () {
			let query = $(this).val();

			if (query.length >= 2) {
				$.ajax({
					url: "/search-party",
					method: "GET",
					data: { search: query },
					success: function (response) {
						let dropdown = $("#dropdown");
						dropdown.empty().show();

						if (response.length > 0) {
							response.forEach(function (item) {
								dropdown.append(`<option value="${item.partyID}">${item.partyName}</option>`);
							});

							$("#dropdown").change(function () {
								let selectedOption = $("#dropdown option:selected");
								$("#PartyName").val(selectedOption.text());  // Set PartyID input field
								$("#PartyID").val(selectedOption.val());    // Set hidden PartyID field
								dropdown.hide();
							});
						} else {
							dropdown.hide();
						}
					}
				});
			} else {
				$("#dropdown").hide();
			}
		});

		$(document).click(function (e) {
			if (!$(e.target).closest(".input-container").length) {
				$("#dropdown").hide();
			}
		});
	});
</script>



<script>
	// Get today's date in YYYY-MM-DD format
	let today = new Date().toISOString().split('T')[0];

	// Set the input field value
	document.getElementById("currentdate").value = today;
</script>